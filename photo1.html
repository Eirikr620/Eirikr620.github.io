<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>사진 업로드 갤러리 (행 단위 우→좌 채움)</title>
  <style>
    @font-face {
      font-family: 'VCR OSD Mono';
      src: url('VCR_OSD_MONO_1.001.ttf') format('truetype');
      font-weight: normal; font-style: normal;
    }
    :root{
      --cols: 3;
      --gap: 0px;               /* 붙여 배치 → 0 */
      --overlay-bg: rgba(0,0,0,.86);
      --close-bg: rgba(0,0,0,.6);
    }
    body{
      margin:0; font-family:'VCR OSD Mono', monospace;
      min-height:100vh; background:#f0f0f0; position:relative;
    }
    /* 드래그 메뉴는 그대로 */
    .ztmy-menu-container{
      position:absolute; top:80px; left:30px; width:150px; padding:10px;
      background:#f0f0f0; border:2px solid #000; box-shadow:5px 5px 0 #000;
      cursor:grab; z-index:1000;
    }
    .menu-title{font-size:1.2em; font-weight:bold; padding-bottom:5px; border-bottom:2px solid #000; margin-bottom:10px;}
    .menu-list{list-style:none; margin:0; padding:0;}
    .menu-list li a{display:block; padding:5px 0; text-decoration:none; color:#000;}
    .menu-list li a:hover{background:#ccc;}

    .content{padding:20px; max-width:800px; margin:0 auto;}
    .uploader{
      display:inline-flex; align-items:center; gap:10px; margin:10px 0 18px;
      padding:10px 14px; border:2px solid #000; background:#fff; border-radius:10px;
      box-shadow:4px 4px 0 #000; cursor:pointer; user-select:none;
      transition:transform .12s, box-shadow .12s, background-color .2s;
      color:#000; text-decoration:none;
    }
    .uploader:hover{ background:#f6f6f6; }
    .uploader:active{ transform:translate(1px,1px); box-shadow:3px 3px 0 #000; }
    .uploader input{ display:none; }

    /* === 갤러리: 3열, 셀 단위 렌더 === */
    .gallery{
      display:grid;
      grid-template-columns: repeat(var(--cols), 1fr);
      gap: var(--gap);
    }
    /* 실제 셀(썸네일)과 스페이서가 동일한 셀 크기를 갖도록 공통 규칙 */
    .cell{
      position:relative; aspect-ratio:1/1; overflow:hidden;
    }
    .spacer{
      visibility:hidden; pointer-events:none; /* 공간만 차지 */
      background:transparent;
    }
    .item{
      display:block; cursor:pointer; background:#e5e7eb;
    }
    .item img{
      width:100%; height:100%; object-fit:cover; display:block;
    }

    /* 라이트박스 */
    .lightbox{
      position:fixed; inset:0; background:var(--overlay-bg);
      display:none; align-items:center; justify-content:center; padding:24px; z-index:2000;
    }
    .lightbox.open{ display:flex; }
    .lightbox__inner{ position:relative; max-width:95vw; max-height:95vh; }
    .lightbox__img{ max-width:95vw; max-height:95vh; border-radius:8px; box-shadow:0 20px 60px rgba(0,0,0,.5); display:block; }
    .lightbox__close{
      position:absolute; top:-14px; right:-14px; width:38px; height:38px; border-radius:999px;
      background:var(--close-bg); color:#fff; border:2px solid #fff;
      display:flex; align-items:center; justify-content:center; font-size:18px; cursor:pointer;
    }
    .lightbox__close:focus-visible{ outline:3px dashed #fff; outline-offset:2px; }

    @media (max-width:520px){ :root{ --cols:2; } } /* 모바일 2열 옵션 */
  </style>
</head>
<body>
  <div class="ztmy-menu-container" id="draggable-menu">
    <div class="menu-title">Menu</div>
    <ul class="menu-list">
      <li><a href="index.html">TOP</a></li>
      <li><a href="profile.html">PROFILE</a></li>
      <li><a href="blog1.html">BLOG</a></li>
      <li><a href="projects.html">PROJECTS</a></li>
      <li><a href="photo1.html">PHOTO</a></li>
    </ul>
  </div>

  <div class="content">
    <h1>PHOTOS</h1>
    <label class="uploader">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M12 5v14M5 12h14" stroke="#000" stroke-width="2" stroke-linecap="round"/></svg>
      <span>사진 업로드</span>
      <input id="fileInput" type="file" accept="image/*" multiple />
    </label>

    <div id="gallery" class="gallery" aria-live="polite" aria-busy="false"></div>
  </div>

  <!-- 라이트박스 -->
  <div class="lightbox" id="lightbox" role="dialog" aria-modal="true" aria-label="원본 이미지 보기">
    <div class="lightbox__inner">
      <img class="lightbox__img" id="lightboxImg" alt="" />
      <button class="lightbox__close" id="lightboxClose" aria-label="닫기(ESC)">✕</button>
    </div>
  </div>

<script>
  /* 드래그 가능한 메뉴 */
  const menu = document.getElementById('draggable-menu');
  let isDragging=false, initialX, initialY, offsetX, offsetY;
  menu.addEventListener('mousedown', e => {
    isDragging = true; initialX = e.clientX; initialY = e.clientY;
    offsetX = menu.offsetLeft; offsetY = menu.offsetTop; menu.style.cursor='grabbing'; e.preventDefault();
  });
  document.addEventListener('mousemove', e => {
    if (!isDragging) return;
    const dx = e.clientX - initialX, dy = e.clientY - initialY;
    menu.style.left = `${offsetX + dx}px`; menu.style.top = `${offsetY + dy}px`;
  });
  document.addEventListener('mouseup', () => { isDragging=false; menu.style.cursor='grab'; });

  /* 갤러리 데이터 & 렌더 */
  const input = document.getElementById('fileInput');
  const gallery = document.getElementById('gallery');
  const lightbox = document.getElementById('lightbox');
  const lightboxImg = document.getElementById('lightboxImg');
  const lightboxClose = document.getElementById('lightboxClose');

  // 업로드된 사진을 "오래된→최신" 순으로 보관
  const photos = []; // [{src, alt}...]

  input.addEventListener('change', () => {
    const files = Array.from(input.files || []);
    files.forEach(file => {
      if (!file.type.startsWith('image/')) return;
      const url = URL.createObjectURL(file);
      photos.push({ src: url, alt: file.name || '업로드 이미지' }); // 배열 끝 = 최신
    });
    input.value = '';
    render(); // 규칙에 맞게 재배치
  });

  function render(){
    gallery.innerHTML = '';
    const n = photos.length;
    if (n === 0) return;

    // 최상단 행의 아이템 수: n % 3 (0이면 3)
    let firstRowSize = n % 3 === 0 ? 3 : n % 3;
    let remaining = n;
    let cursor = n - 1; // 최신 인덱스부터 내려감

    // 각 행을 위에서 아래로 생성
    while (remaining > 0) {
      const size = (cursor === n - 1) ? firstRowSize : 3; // 첫 행만 부분 채움 가능
      // 오른쪽 정렬을 위해 좌측에 스페이서 (3 - size)개
      for (let k = 0; k < 3 - size; k++) {
        const spacer = document.createElement('div');
        spacer.className = 'cell spacer';
        spacer.setAttribute('aria-hidden', 'true');
        gallery.appendChild(spacer);
      }
      // 이 행의 아이템: 최신→이전 순서로 채움 (좌→우)
      for (let j = 0; j < size; j++) {
        const p = photos[cursor - j];
        const a = document.createElement('a');
        a.className = 'cell item';
        a.href = p.src;
        a.setAttribute('aria-label', '원본 보기');
        const img = document.createElement('img');
        img.src = p.src; img.alt = p.alt;
        a.appendChild(img);
        a.addEventListener('click', (e) => { e.preventDefault(); openLightbox(p.src, p.alt); });
        gallery.appendChild(a);
      }
      cursor -= size;
      remaining -= size;
    }
  }

  // 라이트박스
  function openLightbox(src, alt='원본 이미지'){
    lightboxImg.src = src; lightboxImg.alt = alt;
    lightbox.classList.add('open'); document.body.style.overflow='hidden';
  }
  function closeLightbox(){
    lightbox.classList.remove('open'); document.body.style.overflow='';
  }
  lightbox.addEventListener('click', (e) => { if (e.target === lightbox) closeLightbox(); });
  lightboxClose.addEventListener('click', closeLightbox);
  window.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeLightbox(); });
</script>
</body>
</html>
